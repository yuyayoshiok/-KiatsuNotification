# 気圧通知ツール（Kiatsu Notifier）

このツールは、OpenWeatherMap APIを使用して気圧情報を取得し、LINEボットを通じて通知を送信するアプリケーションです。低気圧の日や気圧の急激な変化がある日に事前に通知することで、気圧の変化による体調不良を予防するのに役立ちます。

## 機能

- 5日間の気圧予報を取得し、低気圧の日を通知
- 24時間の詳細な時間単位の気圧データを提供
- 前日比で大きな気圧変化がある日を検出して警告
- 時間単位の気圧変化を矢印（↑↓→）で視覚的に表示
- LINE通知機能による簡単な情報確認
- Groq APIによる気圧に基づいた健康アドバイスの提供
- 予測アラート機能：急激な気圧変化が予測される際に事前通知
- 地域カスタマイズ：複数の地域の気圧情報を取得して通知
- GitHub ActionsによるCI/CD：コードをGitHubにプッシュすると自動的にLambda関数を更新

## 設定方法

1. `.env.example`ファイルをコピーして`.env`ファイルを作成
2. 以下の環境変数を設定:
   - `OPENWEATHER_API_KEY`: OpenWeatherMapのAPIキー
   - `LINE_CHANNEL_ACCESS_TOKEN`: LINE Messaging APIのチャネルアクセストークン
   - `LINE_USER_ID`: 通知を送信するLINEユーザーID
   - `CITY_ID`: 天気情報を取得する都市ID（デフォルトは島根県松江市: 1857550）
   - `PRESSURE_THRESHOLD`: 低気圧と判定する閾値（hPa）（デフォルト: 1010hPa）
   - `PRESSURE_CHANGE_THRESHOLD`: 警告する気圧変化の閾値（hPa）（デフォルト: 6hPa）
   - `PRESSURE_ALERT_THRESHOLD`: 予測アラートの閾値（hPa）（デフォルト: 8hPa）
   - `GROQ_API_KEY`: Groq APIキー（健康アドバイス機能用）
   - `USE_GROQ`: Groq APIを使用するかどうか（'true'または'false'）
   - `REGION_CUSTOMIZATION`: 地域カスタマイズを有効にするかどうか（'true'または'false'）
   - `CUSTOM_CITY_IDS`: 追加で気圧情報を取得する都市IDのカンマ区切りリスト（例: '1850147,1856057'）

## 使用方法

### ローカルでのテスト

```bash
# 環境変数を設定した状態でテスト実行
python test_locally.py
```

### AWS Lambdaへのデプロイ

```bash
# デプロイパッケージの作成
./deploy.sh
```

作成されたZIPファイルをAWS Lambdaにアップロードし、環境変数を設定してください。
EventBridgeを使用して定期的に実行するようにスケジュールすることができます。
詳細な設定方法は `setup_aws.md` を参照してください。

### GitHub ActionsによるCI/CD

1. GitHubにリポジトリを作成し、コードをプッシュします。
2. リポジトリの「Settings」→「Secrets and variables」→「Actions」で必要なシークレットを設定します。
3. コードをメインブランチにプッシュすると、自動的にLambda関数が更新されます。

詳細な設定方法は `setup_aws.md` の「GitHub ActionsによるCI/CD設定」セクションを参照してください。

## 予測アラート機能

予測アラート機能は、今後24時間以内に急激な気圧変化が予測される場合に自動的に通知を送信します。
通知には、予測される気圧変化の大きさと時間が含まれます。

## 地域カスタマイズ機能

地域カスタマイズ機能を使用すると、複数の地域の気圧情報を取得して通知を受け取ることができます。
各地域ごとに別々の通知が送信され、通知には都市名、現在の気圧、24時間後の予測気圧、気圧変化が含まれます。

## 気圧と健康について

気圧の変化は、特に気象病（気象過敏症）の方にとって体調に影響を与えることがあります。一般的に以下のような状況で体調不良が起こりやすいとされています：

1. **絶対的な低気圧**: 1010hPa以下の低気圧
2. **急激な気圧変化**: 24時間で6hPa以上の気圧変化

このツールは、これらの条件を監視し、事前に警告することで体調管理をサポートします。さらに、AIによる気圧状況に基づいた健康アドバイスも提供します。

## 依存パッケージ

- requests: HTTP通信用
- python-dotenv: 環境変数管理用
- line-bot-sdk: LINE Messaging API用
- boto3: AWS S3連携用（オプション）
- pytz: タイムゾーン処理用

## 注意事項

- OpenWeatherMap APIの無料プランでは、APIコール数に制限があります
- 気圧の閾値は個人の体調に合わせて調整してください
- このツールは医療アドバイスを提供するものではありません
- Groq APIは無料で利用できます
